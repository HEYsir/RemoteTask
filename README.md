# Rust Concurrent HTTP Request Tool

这是一个用Rust实现的并发HTTP请求工具，支持控制A请求和B请求之间的延迟，以及连续A请求之间的延迟。

## 功能特性

- ✅ 发送A请求后发送B请求
- ✅ 持续发送请求（可配置最大次数）
- ✅ 控制A请求和B请求之间的延迟
- ✅ 控制连续A请求之间的延迟
- ✅ 防止A请求重叠（修复版本）
- ✅ 详细的请求统计和错误处理

## 项目结构

```
src/
├── main.rs                 # 原始顺序实现版本
├── test_concurrent.rs      # 测试程序（用于检测重叠）
├── concurrent_fixed.rs     # 修复版本（防止A请求重叠）
└── concurrent_parallel.rs  # 真正并行版本（A和B并发发送）
```

## 使用方法

### 运行原始版本（顺序执行）

```bash
cargo run --bin main
```

### 运行测试程序（检测重叠）

```bash
cargo run --bin test_concurrent
```

### 运行修复版本（防止重叠，顺序执行）

```bash
cargo run --bin concurrent_fixed
```

### 运行并行版本（A和B并发发送）

```bash
cargo run --bin concurrent_parallel
```

## 配置参数

在代码中可以配置以下参数：

- `url_a`: A请求的URL
- `url_b`: B请求的URL  
- `delay_between_a_and_b_ms`: A和B请求之间的延迟（毫秒）
- `delay_between_a_requests_ms`: 连续A请求之间的延迟（毫秒）
- `max_requests`: 最大请求次数（可选）

## 实现说明

### 原始实现的问题

原始实现使用简单的循环和延迟，可能会导致A请求重叠：

- 每个周期：A请求 → 延迟 → B请求 → 延迟 → 下一个A请求
- 如果A请求+延迟+B请求的总时间超过A请求之间的间隔，就会发生重叠

### 修复版本

修复版本通过精确的时间控制防止A请求重叠：

- 在每个周期开始时检查距离上次A请求的时间
- 如果时间不足，等待剩余时间再发送A请求
- 确保A请求之间的间隔始终满足配置要求

### 并行版本（推荐）

并行版本实现了真正的并发请求：

- **A请求发送后立即发送B请求**：不等待A请求返回
- **A和B请求并发执行**：使用独立的异步任务
- **精确的延迟控制**：A→B延迟和A→A延迟都可控
- **防止A请求重叠**：确保连续A请求之间的间隔

## 关键行为对比

| 版本 | A和B请求关系 | A请求间隔控制 | 推荐场景 |
|------|-------------|--------------|----------|
| 原始版本 | 顺序执行（A完成→B） | 可能重叠 | 简单测试 |
| 修复版本 | 顺序执行（A完成→B） | 精确控制 | 需要精确间隔 |
| **并行版本** | **并发执行（A发送→B发送）** | **精确控制** | **生产环境** |

## 测试结果

通过测试程序验证：

- ✅ 原始版本确实存在A请求重叠问题
- ✅ 修复版本正确防止了A请求重叠
- ✅ 延迟控制精确有效

## 技术栈

- **Rust** - 编程语言
- **Tokio** - 异步运行时
- **Reqwest** - HTTP客户端
- **Serde** - 序列化/反序列化

## 许可证

MIT License
